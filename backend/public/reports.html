<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reports</title>

    <!-- ----------------------------------------------------------------------------- -->
    <!-- css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css" />
    <style>
        html,
body {
  height: 100%;
  width: 100%;
  background-color: #effeff;
}
/* 293241 dark
  3d5a80 blue
  98c1d9 light
*/
.editDelete {
  float: right;
  margin: 3px;
  padding: 3px 10px;
}
#png {
  margin-right: 10px;
}
#navigation {
  background-color: #233b64;
}
#form1 {
  border-radius: 10px;
  background-color: #3d5a80;
  box-shadow: 4px 4px 9px #293241;
  margin: 20px 193px;
}
#table {
  border-radius: 10px;
  background-color: #d2eaf7;
  /* background-image: linear-gradient(to bottom right, #c7e9fd, #3d5a80); */
  box-shadow: 4px 4px 9px #b8b8b8;
}
#submitBtn {
  width: 140px;
  background-color: #293241;
  border-color: #293241;
  color: white;
}
.showBtn {
  width: 80px;
  background-color: #293241;
  border-color: #293241;
  color: white;
}
.topBtn {
  background-color: white;
  border-color: white;
  color: #293241;
}
#year-input {
  background-color: white;
  width: auto;
  border: 1px;
  border-radius: 7px;
  color: #293241;
  padding: 7px;
  margin: 7px -4px;
}
#categoryBtn {
  background-color: #293241;
  width: auto;
  border-radius: 7px;
  border: none;
  color: white;
}
#category {
  width: 300px;
}
.input-group-text {
  background-color: #293241;
  color: white;
  border: none;
}
#description {
  width: 2000px;
}

.trStyle {
  background-color: transparent;
}
#categoryBtn:hover,
#submitBtn:hover,
.editDelete:hover,
.showBtn:hover {
  background-color: #ffffff;
  color: #293241;
  border-color: #293241;
}
.topBtn:hover {
  background-color: #3d5a80;
  color: white;
  border-color: #3d5a80;
}
.editDelete {
  background-color: #293241;
  border: none;
}

#dailyTotal,
#dailyTotalAmount,
#monthlyTotal,
#monthlyTotalAmount {
  font-weight: bolder !important;
}
    </style>
</head>

<body>
    <!--------------------------------------------------------------------------------- -->
    <!-- Nav Bar -->

    <nav class="navbar navbar-expand-lg navbar-dark" id="navigation">
        <div class="container-fluid">
            <a href="/homePage">
                <img src="/views/euro.png" width="30px" height="30px" id="png" />
            </a>
            <a class="navbar-brand" href="/homePage">Expense Tracker</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/homePage">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/reports/getReportsPage">Reports &#128081
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/premium/getLeaderboardPage">LeaderBoard
                            &#128081
                        </a>
                    </li>
                </ul>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button class="topBtn btn py-1" type="button" data-bs-toggle="tooltip" data-bs-placement="left"
                        title="Premium Membership inclues LeaderBoard & Daily & Monthly Reports">
                        Premium Member &#128081
                    </button>
                    <button id="logoutBtn" class="topBtn btn py-1" type="button">Log out</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ----------------------------------------------------------------------- -->
    <!-- Daily Table -->

    <div class="container table-responsive mt-4 p-3 d-flex bd-highlight" id="table">
        <!-- ------------------------------------------------------------------------- -->
        <!-- Daily table Form -->

        <div class="ps-2 pe-5 py-1 ms-3 me-5 my-1 bd-highlight">
            <div class="my-1">
                <h3>DAILY REPORTS</h3>
            </div>
            <div>
                <form>
                    <div class="mb-3">
                        <label for="date" class="form-label"> Select Date</label>
                        <input type="date" class="form-control" id="date" />
                    </div>
                    <button id="dateShowBtn" type="submit" class="btn btn-primary showBtn">Show</button>
                </form>
            </div>
        </div>

        <div class="p-2 flex-grow-1 bd-highlight">
            <table id="table1" class="table table-hover display" style="width: 100%">
                <!-- ------------------------------------------------------------------------- -->
                <!-- Daily table head -->

                <thead>
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Category</th>
                        <th scope="col">Description</th>
                        <th scope="col">Amount</th>
                    </tr>
                </thead>

                <!-- ------------------------------------------------------------------------- -->
                <!-- Daily table body -->

                <tbody id="tbodyDailyId">
                </tbody>
                <tfoot id="tfootDailyId">
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- ------------------------------------------------------------------------- -->
    <!-- Monthly Table -->

    <div class="container table-responsive mt-4 p-3 d-flex bd-highlight" id="table">
        <!-- ------------------------------------------------------------------------- -->
        <!-- Monthly table Form -->

        <div class="px-2 py-1 ms-3 me-4 my-1 bd-highlight">
            <div class="my-1">
                <h3>MONTHLY REPORTS</h3>
            </div>
            <div>
                <form>
                    <div class="mb-3">
                        <label for="month" class="form-label">Select Month</label>
                        <input type="month" class="form-control" id="month" />
                    </div>
                    <button id="monthShowBtn" type="submit" class="btn btn-primary showBtn">Show</button>
                </form>
            </div>
        </div>

        <div class="p-2 flex-grow-1 bd-highlight">
            <table id="table2" class="table table-hover display" style="width: 100%">
                <!-- ------------------------------------------------------------------------- -->
                <!-- Monthly table head -->

                <thead>
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Category</th>
                        <th scope="col">Description</th>
                        <th scope="col">Amount</th>
                    </tr>
                </thead>

                <!-- ------------------------------------------------------------------------- -->
                <!-- Monthly table body -->

                <tbody id="tbodyMonthlyId">

                </tbody>

                <tfoot id="tfootMonthlyId">

                </tfoot>
            </table>
        </div>
    </div>

   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.2/axios.min.js"
        integrity="sha512-QTnb9BQkG4fBYIt9JGvYmxPpd6TBeKp6lsUrtiVQsrJ9sb33Bn9s0wMQO9qVBFbPX3xHRAsBHvXlcsrnJjExjg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        const dateInput = document.getElementById("date");
        const dateShowBtn = document.getElementById("dateShowBtn");
        const tbodyDaily = document.getElementById("tbodyDailyId");
        const tfootDaily = document.getElementById("tfootDailyId");

        const monthInput = document.getElementById("month");
        const monthShowBtn = document.getElementById("monthShowBtn");
        const tbodyMonthly = document.getElementById("tbodyMonthlyId");
        const tfootMonthly = document.getElementById("tfootMonthlyId");

        const logoutBtn = document.getElementById("logoutBtn");

        async function getDailyReport(e) {
            try {
                e.preventDefault();
                const token = localStorage.getItem("token");
                const date = new Date(dateInput.value);
                const formattedDate = `${date.getDate().toString().padStart(2, "0")}-${(
                    date.getMonth() + 1
                )
                    .toString()
                    .padStart(2, "0")}-${date.getFullYear()}`;

                let totalAmount = 0;
                const res = await axios.post(
                    "http://localhost:3000/reports/dailyReports",
                    {
                        date: formattedDate,
                    },
                    { headers: { Authorization: token } }
                );

                tbodyDaily.innerHTML = "";
                tfootDaily.innerHTML = "";

                res.data.forEach((expense) => {
                    totalAmount += expense.amount;

                    const tr = document.createElement("tr");
                    tr.setAttribute("class", "trStyle");
                    tbodyDaily.appendChild(tr);

                    const th = document.createElement("th");
                    th.setAttribute("scope", "row");
                    th.appendChild(document.createTextNode(expense.date));

                    const td1 = document.createElement("td");
                    td1.appendChild(document.createTextNode(expense.category));

                    const td2 = document.createElement("td");
                    td2.appendChild(document.createTextNode(expense.description));

                    const td3 = document.createElement("td");
                    td3.appendChild(document.createTextNode(expense.amount));

                    tr.appendChild(th);
                    tr.appendChild(td1);
                    tr.appendChild(td2);
                    tr.appendChild(td3);
                });

                const tr = document.createElement("tr");
                tr.setAttribute("class", "trStyle");
                tfootDaily.appendChild(tr);

                const td1 = document.createElement("td");
                const td2 = document.createElement("td");
                const td3 = document.createElement("td");
                const td4 = document.createElement("td");

                td3.setAttribute("id", "dailyTotal");
                td4.setAttribute("id", "dailyTotalAmount");
                td3.appendChild(document.createTextNode("Total"));
                td4.appendChild(document.createTextNode(totalAmount));

                tr.appendChild(td1);
                tr.appendChild(td2);
                tr.appendChild(td3);
                tr.appendChild(td4);
            } catch (error) {
                console.log(error);
            }
        }

        async function getMonthlyReport(e) {
            try {
                e.preventDefault();
                const token = localStorage.getItem("token");
                const month = new Date(monthInput.value);
                const formattedMonth = `${(month.getMonth() + 1)
                    .toString()
                    .padStart(2, "0")}`;

                let totalAmount = 0;
                const res = await axios.post(
                    "http://localhost:3000/reports/monthlyReports",
                    {
                        month: formattedMonth,
                    },
                    { headers: { Authorization: token } }
                );

                tbodyMonthly.innerHTML = "";
                tfootMonthly.innerHTML = "";

                res.data.forEach((expense) => {
                    totalAmount += expense.amount;

                    const tr = document.createElement("tr");
                    tr.setAttribute("class", "trStyle");
                    tbodyMonthly.appendChild(tr);

                    const th = document.createElement("th");
                    th.setAttribute("scope", "row");
                    th.appendChild(document.createTextNode(expense.date));

                    const td1 = document.createElement("td");
                    td1.appendChild(document.createTextNode(expense.category));

                    const td2 = document.createElement("td");
                    td2.appendChild(document.createTextNode(expense.description));

                    const td3 = document.createElement("td");
                    td3.appendChild(document.createTextNode(expense.amount));

                    tr.appendChild(th);
                    tr.appendChild(td1);
                    tr.appendChild(td2);
                    tr.appendChild(td3);
                });

                const tr = document.createElement("tr");
                tr.setAttribute("class", "trStyle");
                tfootMonthly.appendChild(tr);

                const td1 = document.createElement("td");
                const td2 = document.createElement("td");
                const td3 = document.createElement("td");
                const td4 = document.createElement("td");

                td3.setAttribute("id", "monthlyTotal");
                td4.setAttribute("id", "monthlyTotalAmount");
                td3.appendChild(document.createTextNode("Total"));
                td4.appendChild(document.createTextNode(totalAmount));

                tr.appendChild(td1);
                tr.appendChild(td2);
                tr.appendChild(td3);
                tr.appendChild(td4);
            } catch (error) {
                console.log(error);
            }
        }

        async function logout() {
            try {
                localStorage.clear();
                window.location.href = "/";
            } catch (error) {
                console.log(error);
            }
        }

        dateShowBtn.addEventListener("click", getDailyReport);
        monthShowBtn.addEventListener("click", getMonthlyReport);
        logoutBtn.addEventListener("click", logout);
    </script>
</body>

</html>